import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$net from"net";import*as esm_import$readline from"readline";import*as esm_import$vm from"vm";
var jZ=function(a){var b=function(){var e=$APP.hu.h(a,"(");return $APP.l(e)?new $APP.F(null,2,5,$APP.H,[$APP.gk.j(a,0,e+1),$APP.gk.h(a,e+1)],null):new $APP.F(null,2,5,$APP.H,[null,a],null)}(),c=$APP.A.j(b,0,null),d=$APP.A.j(b,1,null);b=$APP.Xe.h(function(){try{return $APP.Usa(new $APP.k(null,2,[$APP.S,$APP.m.g($APP.r(iZ)),$APP.NF,d],null))}catch(f){var e=f;console.warn($APP.m.g($APP.Ria),$APP.Gl(e));return null}}(),"completions");return $APP.sk.h(function(e){return[$APP.m.g(c),$APP.m.g(e)].join("")},
$APP.Oh(function(e){return $APP.Ca(e,d)},$APP.sk.h(function(e){return $APP.Xe.h(e,"candidate")},b)))},Vva=function(a){return[$APP.ov.g(jZ(a)),a]},nZ=function(a,b){$APP.uh(kZ,!1);a.setPrompt([$APP.m.g($APP.r(iZ)),"\x3d\x3e "].join(""));a.prompt();return $APP.Hm($APP.r(lZ))?null:mZ.h?mZ.h(b,a):mZ.call(null,b,a)},Wva=function(a){var b=$APP.Ym(a);a=$APP.Zm(a);var c=$APP.Fm($APP.r(lZ));b=$APP.Ch.h(b-1,c);c=$APP.u(b);b=$APP.x(c);c=$APP.y(c);a=$APP.l(b)?$APP.gk.h(b,a):null;$APP.uh(lZ,$APP.wp.h("\n",$APP.pg(a,
c)))},Xva=function(a,b){b={f:b};esm_import$vm.createContext(b);try{return $APP.l($APP.l(oZ)?$APP.ub(a):oZ)&&process.stdin.setRawMode(!1),esm_import$vm.runInContext("f()",b,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"}).then(function(c){var d={f:$APP.l(a)?function(){return c}:function(){var e=$APP.x(c);$APP.ky.l($APP.B([e]));return c}};esm_import$vm.createContext(d);return esm_import$vm.runInContext("f()",d,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"})}).finally(function(){return $APP.l($APP.l(oZ)?
$APP.ub(a):oZ)?process.stdin.setRawMode(!0):null})}catch(c){return b=c,$APP.l($APP.l(oZ)?$APP.ub(a):oZ)&&process.stdin.setRawMode(!0),Promise.reject(b)}},mZ=function(a,b){if($APP.l(function(){var e=$APP.r(kZ);return $APP.l(e)?e:$APP.Hm($APP.r(lZ))}()))return null;$APP.uh(kZ,!0);var c=$APP.Er($APP.r(lZ)),d=function(){try{var e=$APP.Qg([$APP.Zs,$APP.r(iZ)]);$APP.fs(e);try{return $APP.Ky(c)}finally{$APP.hs()}}catch(f){e=f;if(-1!=$APP.Gl(e).indexOf("EOF while reading"))return Yva;Wva(c);$APP.ky.l($APP.B([$APP.m.g(e)]));
return Zva}}();if($APP.z.h(Zva,d))return nZ(b,a);if($APP.z.h(Yva,d))return $APP.uh(kZ,!1);Wva(c);if($APP.z.h($APP.dD,d))return $APP.uh(kZ,!1);$APP.fs($APP.Qg([$APP.Zs,$APP.r(iZ)]));return Xva(a,function(){return $APP.Nsa(d,new $APP.k(null,3,[$APP.S,$APP.r(iZ),$APP.yn,$APP.r($APP.Is),$APP.xL,$APP.lA],null))}).then(function(e){var f=$APP.A.j(e,0,null);e=$APP.A.j(e,1,null);e=$APP.Sg(e);e=$APP.Xe.h(e,$APP.S);$APP.uh(iZ,e);$APP.dV.h($APP.LU,$APP.sh($APP.r($APP.KU)));$APP.dV.h($APP.KU,$APP.sh($APP.r($APP.JU)));
$APP.dV.h($APP.JU,$APP.sh(f));$APP.l(a)&&a.write($APP.HA.l($APP.B([f])));return nZ(b,a)}).catch(function(e){$APP.ky.l($APP.B([$APP.m.g(e)]));$APP.dV.h($APP.MU,$APP.sh(e));return nZ(b,a)}).finally(function(){return $APP.hs()})},$va=function(a,b){a.on("line",function(c){$APP.Sk.C(lZ,$APP.m,c,"\n");return mZ(b,a)})},awa=function(a){return esm_import$readline.createInterface({input:a,output:a,completer:Vva})},bwa=function(a){var b=awa(a);$va(b,a);a.setNoDelay(!0);return a.on("close",function(){return $APP.KA.l($APP.B(["Client closed connection."]))})},
pZ=new $APP.t(null,"nbb.impl.repl","nbb.impl.repl",-339140484,null),Yva=new $APP.E("nbb.impl.repl","eof-while-reading","nbb.impl.repl/eof-while-reading",1743626215),cwa=new $APP.t("nbb.impl.repl","completer*","nbb.impl.repl/completer*",455172317,null),dwa=new $APP.t("nbb.impl.repl","repl","nbb.impl.repl/repl",-1645296655,null),ewa=new $APP.t(null,"completer*","completer*",-648150376,null),fwa=new $APP.t(null,"get-completions","get-completions",1933789168,null),gwa=new $APP.t("nbb.impl.repl","socket-repl",
"nbb.impl.repl/socket-repl",1509490200,null),hwa=new $APP.E(null,"init","init",-1875481434),Zva=new $APP.E("nbb.impl.repl","continue","nbb.impl.repl/continue",-1326808644);var iZ=$APP.Rk.g($APP.r($APP.Zs)),lZ=$APP.Rk.g(""),kZ=$APP.Rk.g(!1),oZ,iwa=process.stdout.isTTY;oZ=$APP.l(iwa)?process.stdin.setRawMode:iwa;var qZ=$APP.hV.h($APP.oB,null),rZ=function rZ(a){switch(arguments.length){case 0:return rZ.A();case 1:return rZ.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.m.g(arguments.length)].join(""));}};rZ.A=function(){return rZ.g(null)};
rZ.g=function(a){var b=function(){var d=$APP.jX.g(a);return $APP.l(d)?d:0}(),c=esm_import$net.createServer(bwa);return c.listen(b,"127.0.0.1",function(){var d=c.address(),e=d.address;return $APP.KA.l($APP.B([["Socket REPL listening on port ",$APP.m.g(d.port)," on host ",$APP.m.g(e)].join("")]))})};rZ.o=1;var sZ=function sZ(a){switch(arguments.length){case 0:return sZ.A();case 1:return sZ.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.m.g(arguments.length)].join(""));}};sZ.A=function(){return sZ.g(null)};
sZ.g=function(a){function b(e){return $APP.Lsa(new $APP.D(null,$APP.Xl,new $APP.D(null,new $APP.D(null,$APP.Xl,new $APP.D(null,e,null,1,null),2,null),null,1,null),2,null))}$APP.l(oZ)&&process.stdin.setRawMode(!0);var c=$APP.A.j($APP.oV,0,null),d=$APP.A.j($APP.oV,1,null);$APP.KA.l($APP.B([["Welcome to nbb v",$APP.jz(),"!"].join("")]));return b(c).then(function(){return b(d)}).then(hwa.h(a,$APP.mf)).then(function(){return new Promise(function(e){var f=$APP.l(null)?awa(null):esm_import$readline.createInterface({input:process.stdin,
output:process.stdout,completer:Vva});$va(f,null);f.setPrompt([$APP.m.g($APP.r(iZ)),"\x3d\x3e "].join(""));f.on("close",e);return f.prompt()})})};sZ.o=1;
var jwa=new $APP.k(null,3,[$APP.lX,function(){var a=new $APP.Id(function(){return sZ},dwa,$APP.kj([$APP.S,$APP.P,$APP.yn,$APP.sD,$APP.RJ,$APP.Fo,$APP.zn,$APP.sS,$APP.Y,$APP.O,$APP.yQ],[pZ,$APP.lX,"nbb/impl/repl.cljs",11,new $APP.k(null,6,[$APP.JE,!1,$APP.Mv,1,$APP.JP,1,$APP.eO,new $APP.F(null,2,5,$APP.H,[$APP.Nh,new $APP.F(null,1,5,$APP.H,[$APP.fC],null)],null),$APP.Y,$APP.I($APP.Nh,new $APP.F(null,1,5,$APP.H,[$APP.fC],null)),$APP.kQ,$APP.I(null,null)],null),1,186,186,$APP.I($APP.Nh,new $APP.F(null,
1,5,$APP.H,[$APP.fC],null)),null,$APP.l(sZ)?sZ.F:null])),b=$APP.r(a),c=$APP.Ce(a);a=$APP.l(null)?null:$APP.P.g(c);var d=new $APP.k(null,4,[$APP.S,qZ,$APP.P,a,$APP.Y,$APP.Y.g(c),$APP.O,$APP.O.g(c)],null);return $APP.l($APP.it.g(c))?$APP.bV.j(a,b,d):$APP.l(function(){var e=$APP.ts.g(c);return $APP.l(e)?e:$APP.Ks.g(c)}())?$APP.cV.j(a,b,d):$APP.Tx.j(a,b,d)}(),fwa,function(){var a=new $APP.Id(function(){return jZ},cwa,$APP.kj([$APP.S,$APP.P,$APP.yn,$APP.sD,$APP.Fo,$APP.zn,$APP.sS,$APP.Y,$APP.O,$APP.yQ],
[pZ,ewa,"nbb/impl/repl.cljs",17,1,15,15,$APP.I(new $APP.F(null,1,5,$APP.H,[$APP.Rha],null)),"Given a line, returns a flat vector of completions",$APP.l(jZ)?jZ.F:null])),b=$APP.r(a),c=$APP.Ce(a);a=$APP.l(null)?null:$APP.P.g(c);var d=new $APP.k(null,4,[$APP.S,qZ,$APP.P,a,$APP.Y,$APP.Y.g(c),$APP.O,$APP.O.g(c)],null);return $APP.l($APP.it.g(c))?$APP.bV.j(a,b,d):$APP.l(function(){var e=$APP.ts.g(c);return $APP.l(e)?e:$APP.Ks.g(c)}())?$APP.cV.j(a,b,d):$APP.Tx.j(a,b,d)}(),$APP.kX,function(){var a=new $APP.Id(function(){return rZ},
gwa,$APP.kj([$APP.S,$APP.P,$APP.yn,$APP.sD,$APP.RJ,$APP.Fo,$APP.zn,$APP.sS,$APP.Y,$APP.O,$APP.yQ],[pZ,$APP.kX,"nbb/impl/repl.cljs",18,new $APP.k(null,6,[$APP.JE,!1,$APP.Mv,1,$APP.JP,1,$APP.eO,new $APP.F(null,2,5,$APP.H,[$APP.Nh,new $APP.F(null,1,5,$APP.H,[$APP.fC],null)],null),$APP.Y,$APP.I($APP.Nh,new $APP.F(null,1,5,$APP.H,[$APP.fC],null)),$APP.kQ,$APP.I(null,null)],null),1,171,171,$APP.I($APP.Nh,new $APP.F(null,1,5,$APP.H,[$APP.fC],null)),null,$APP.l(rZ)?rZ.F:null])),b=$APP.r(a),c=$APP.Ce(a);a=
$APP.l(null)?null:$APP.P.g(c);var d=new $APP.k(null,4,[$APP.S,qZ,$APP.P,a,$APP.Y,$APP.Y.g(c),$APP.O,$APP.O.g(c)],null);return $APP.l($APP.it.g(c))?$APP.bV.j(a,b,d):$APP.l(function(){var e=$APP.ts.g(c);return $APP.l(e)?e:$APP.Ks.g(c)}())?$APP.cV.j(a,b,d):$APP.Tx.j(a,b,d)}()],null);$APP.Sy(new $APP.k(null,1,[$APP.Ws,new $APP.k(null,1,[$APP.oB,jwa],null)],null));