import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
import "./nbb_goog_string.js";
import "./nbb_pprint.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$fs from"fs";import*as esm_import$net from"net";import*as esm_import$path from"path";
var lEa=function(a,b){a=a.indexOf(b);if(0>a)throw Error("out of input");return a},I3=function(a,b){if(a.length<b)throw Error("out of input");return a.slice(b)},J3=function(a,b){if(b>a.length)throw Error("out of input");return a.slice(0,b)},K3=function(a){return $APP.l($APP.ly.g($APP.r($APP.nV)))?console.debug($APP.wp.h(" ",a)):null},nEa=function(a){return function(b,c){b=$APP.Sg(b);var d=$APP.Xe.h(b,$APP.Rs),e=$APP.Xe.h(b,mEa);c=$APP.Gj.j(c,"id",d);c=$APP.l(e)?$APP.Gj.j(c,"session",e):c;return a.h?
a.h(b,c):a.call(null,b,c)}},pEa=function(){var a=oEa;return function(b,c){b=$APP.Xo.j(b,L3,$APP.tk);return a.h?a.h(b,c):a.call(null,b,c)}},rEa=function(){var a=qEa();return function(b,c){K3($APP.B(["request",b]));return a.h?a.h(b,c):a.call(null,b,c)}},sEa=function(a){return function(b,c){K3($APP.B(["response",c]));return a.h?a.h(b,c):a.call(null,b,c)}},qEa=function(){var a=pEa();return function(b,c){return a.h?a.h(b,c):a.call(null,b,c)}},tEa=function(a){return $APP.Gj.j($APP.Rj(new $APP.F(null,3,
5,$APP.H,["major","minor","incremental"],null),$APP.VA.g(a.split("."))),"version-string",a)},uEa=function(a,b,c){if($APP.l(a))if(a=M3.g?M3.g(a):M3.call(null,a),$APP.l(a)){b=$APP.Sg(b);var d=$APP.Xe.h(b,$APP.LDa),e=$APP.Xe.h(b,$APP.j3),f=$APP.Xe.h(b,$APP.n3);b=$APP.kb;var h=$APP.ik,n=$APP.w1;$APP.kb=e;$APP.ik=f;$APP.w1=d;try{var q=new $APP.Xa;d=$APP.nb;e=$APP.ob;$APP.nb=!0;$APP.ob=function(p){return q.append(p)};try{a.g?a.g(c):a.call(null,c)}finally{$APP.ob=e,$APP.nb=d}return $APP.m.g(q)}finally{$APP.w1=
n,$APP.ik=h,$APP.kb=b}}else return K3($APP.B(["Pretty-Printing is only supported for clojure.core/prn and clojure.pprint/pprint."])),$APP.Nk.l($APP.B([c]));else return $APP.Nk.l($APP.B([c]))},vEa=function(a,b,c){$APP.dV.h($APP.MU,$APP.sh(c));var d=$APP.Us.g($APP.Fl(c));d=$APP.l(d)?d:c.message;$APP.l(d)&&(d=new $APP.k(null,1,["err",[$APP.m.g(d),"\n"].join("")],null),a.h?a.h(b,d):a.call(null,b,d));c=new $APP.k(null,2,["ex",$APP.m.g(c),"ns",$APP.m.g($APP.r($APP.Zs))],null);return a.h?a.h(b,c):a.call(null,
b,c)},AEa=function(a,b){var c=$APP.Sg(a),d=$APP.Xe.h(c,$APP.S);a=$APP.Xe.h(c,N3);var e=$APP.Xe.h(c,$APP.yn);$APP.Xe.h(c,wEa);$APP.Xe.h(c,xEa);var f=$APP.Er(a),h=function p(q){try{var w=function(){var C=$APP.S.g($APP.se(q));if($APP.l(C))return C;C=$APP.r(O3);return $APP.l(C)?C:d}(),v=$APP.Ny(f,new $APP.k(null,3,[$APP.S,w,$APP.yn,e,$APP.xL,$APP.lA],null));return $APP.z.h($APP.dD,v)?Promise.resolve(q):$APP.Nsa(v,new $APP.k(null,3,[$APP.S,w,$APP.yn,e,$APP.xL,$APP.lA],null)).then(function(C){var G=$APP.A.j(C,
0,null),M=$APP.A.j(C,1,null);M=$APP.S.g(M);$APP.uh(O3,M);$APP.dV.h($APP.LU,$APP.sh($APP.r($APP.KU)));$APP.dV.h($APP.KU,$APP.sh($APP.r($APP.JU)));$APP.dV.h($APP.JU,$APP.sh(G));G=uEa(yEa.g(c),zEa.g(c),G);G=new $APP.k(null,2,["value",G,"ns",$APP.m.g(M)],null);b.h?b.h(c,G):b.call(null,c,G);return p(C)})}catch(C){return vEa(b,c,C),p(null)}};$APP.fs($APP.Qg([$APP.Zs,d,$APP.Is,e,$APP.AT,$APP.r($APP.AT),$APP.FT,!0]));return function(){$APP.dV.h($APP.yT,$APP.sh(function(q){q=new $APP.k(null,1,["out",q],null);
return b.h?b.h(c,q):b.call(null,c,q)}));return h(null).catch($APP.sn.j(vEa,b,c)).finally(function(){var q=new $APP.k(null,2,["ns",$APP.m.g($APP.r(O3)),"status",new $APP.F(null,1,5,$APP.H,["done"],null)],null);return b.h?b.h(c,q):b.call(null,c,q)})}().finally(function(){return $APP.hs()})},BEa=function(a,b){a=$APP.Sg(a);var c=$APP.Xe.h(a,$APP.S),d=$APP.Gj.j;c=$APP.l(c)?$APP.gX($APP.py(),$APP.Ak.g(c)):null;$APP.l(c)||(c=$APP.r(O3),c=$APP.l(c)?c:$APP.r($APP.Zs));return AEa(d.call($APP.Gj,a,$APP.S,c),
b)},P3=function(a,b){var c=$APP.Sg(a),d=$APP.Xe.h(c,$APP.S),e=L3.g(c);try{var f=$APP.S.g(c),h=function(){var M=$APP.Hja.g(c);return $APP.l(M)?M:$APP.so.g(c)}(),n=function(){var M=$APP.l(d)?$APP.gX($APP.py(),$APP.Ak.g(d)):null;if($APP.l(M))return M;M=$APP.r(O3);return $APP.l(M)?M:$APP.r($APP.Zs)}(),q=$APP.Qg([$APP.Zs,n]);$APP.fs(q);try{var p=$APP.Px($APP.py(),$APP.E0("\n(let [ns '%s\n      full-sym '%s]\n  (when-let [v (ns-resolve ns full-sym)]\n    (let [m (meta v)]\n      (assoc m :arglists (:arglists m)\n       :doc (:doc m)\n       :name (:name m)\n       :ns (some-\x3e m :ns ns-name)\n       :val @v))))",
f,h)),w=$APP.O.g(p),v=$APP.yn.g(p),C=$APP.zn.g(p),G=function(){var M=e instanceof $APP.E?e.ea:null;switch(M){case "eldoc":return M=new $APP.k(null,5,["ns",$APP.S.g(p),"name",$APP.P.g(p),"eldoc",$APP.zp.h(function(V){return $APP.zp.h($APP.m,V)},$APP.Y.g(p)),"type",$APP.Se($APP.Ux.g(p))?"function":"variable","status",new $APP.F(null,1,5,$APP.H,["done"],null)],null),$APP.l(w)?$APP.Gj.j(M,"docstring",w):M;case "info":case "lookup":return M=new $APP.k(null,4,["ns",$APP.S.g(p),"name",$APP.P.g(p),"arglists-str",
$APP.wp.h("\n",$APP.sk.h($APP.Nk,$APP.Y.g(p))),"status",new $APP.F(null,1,5,$APP.H,["done"],null)],null),M=$APP.l(w)?$APP.Gj.j(M,"doc",w):M,M=$APP.l(v)?$APP.Gj.j(M,"file",v):M,$APP.l(C)?$APP.Gj.j(M,"line",C):M;default:throw Error(["No matching clause: ",$APP.m.g(M)].join(""));}}();return b.h?b.h(c,G):b.call(null,c,G)}finally{$APP.hs()}}catch(M){if(M instanceof Error)return a=M,f=function(){var V=new $APP.Jj(null,new $APP.k(null,1,["done",null],null),null);return $APP.z.h(e,CEa)?$APP.mg.h(V,"no-eldoc"):
V}(),a=new $APP.k(null,2,["status",f,"ex",$APP.m.g(a)],null),b.h?b.h(c,a):b.call(null,c,a);throw M;}},oEa=function(a,b){a=$APP.Sg(a);var c=$APP.Xe.h(a,L3),d=$APP.Xe.h(DEa,c);if($APP.l(d))return d.h?d.h(a,b):d.call(null,a,b);console.warn($APP.wp.h(" ",$APP.B(["Unhandled operation",c])));c=new $APP.k(null,1,["status",new $APP.F(null,3,5,$APP.H,["error","unknown-op","done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},EEa=function(a){return function(b,c){return a.write(Q3(c))}},FEa=function(a,
b){K3($APP.B(["Connection accepted"]));b.setNoDelay(!0);var c=rEa(),d=nEa(sEa(EEa(b))),e=$APP.Rk.g(null);b.on("data",function(f){var h=$APP.r(e);if($APP.l(h)){f=[$APP.m.g(h),$APP.m.g(f)].join("");$APP.uh(e,null);var n=f}else n=f;a:for(f=$APP.B([$APP.WA,!0]),h=$APP.Nh;;){var q=$APP.qh.j(R3,n,f);n=$APP.A.j(q,0,null);q=$APP.A.j(q,1,null);if(null==n){h=new $APP.F(null,2,5,$APP.H,[h,q],null);break a}h=$APP.mg.h(h,n);n=q}f=$APP.A.j(h,0,null);h=$APP.A.j(h,1,null);$APP.Hm(h)||$APP.uh(e,h);f=$APP.u(f);h=null;
for(var p=q=0;;)if(p<q)n=h.S(null,p),c(n,d),p+=1;else if(f=$APP.u(f))h=f,$APP.Ne(h)?(f=$APP.hd(h),q=$APP.id(h),h=f,n=$APP.me(f),f=q,q=n):(n=$APP.x(h),c(n,d),f=$APP.y(h),h=null,q=0),p=0;else return null});return b.on("close",function(f){return $APP.l(f)?K3($APP.B(["Connection lost"])):K3($APP.B(["Connection closed"]))})},S3=function(a){return Promise.resolve($APP.fX(esm_import$path.resolve("script.cljs"),null)).then(function(){function b(e){return $APP.Lsa(new $APP.D(null,$APP.Xl,new $APP.D(null,new $APP.D(null,
$APP.Xl,new $APP.D(null,e,null,1,null),2,null),null,1,null),2,null))}var c=$APP.A.j($APP.oV,0,null),d=$APP.A.j($APP.oV,1,null);return b(c).then(function(){return b(d)})}).then(function(){var b=$APP.qn.l($APP.B([$APP.r($APP.nV),a])),c=function(){var f=$APP.jX.g(b);return $APP.l(f)?f:0}(),d=function(){var f=$APP.Vsa.g(b);return $APP.l(f)?f:"127.0.0.1"}();(function(){var f=$APP.wb(b)?b.Ui:GEa.g(b);return $APP.l(f)?f:"info"})();var e=esm_import$net.createServer($APP.sn.h(FEa,$APP.Rg));e.listen(c,d,function(){var f=
e.address(),h=f.port;f=f.address;$APP.KA.l($APP.B([["nREPL server started on port ",$APP.m.g(h)," on host ",$APP.m.g(f)," - nrepl://",$APP.m.g(f),":",$APP.m.g(h)].join("")]));$APP.dV.h($APP.FT,$APP.sh(!0));try{return esm_import$fs.writeFileSync(".nrepl-port",$APP.m.g(h))}catch(n){return console.warn($APP.wp.h(" ",$APP.B(["Could not write .nrepl-port",n])))}});return $APP.uh(HEa,e)})},xEa=new $APP.E(null,"_line","_line",232847719),IEa=new $APP.t("nbb.impl.nrepl-server","stop-server!","nbb.impl.nrepl-server/stop-server!",
1628751782,null),T3=new $APP.t(null,"server","server",-1155245649,null),zEa=new $APP.E("nrepl.middleware.print","options","nrepl.middleware.print/options",868480159),JEa=new $APP.t(null,"nbb.impl.nrepl-server","nbb.impl.nrepl-server",-1821079079,null),mEa=new $APP.E(null,"session","session",1008279103),KEa=new $APP.E(null,"lookup","lookup",1225356838),LEa=new $APP.E(null,"expander","expander",379138924),MEa=new $APP.t("nbb.impl.nrepl-server","start-server!","nbb.impl.nrepl-server/start-server!",-2119141227,
null),NEa=new $APP.E(null,"load-file","load-file",-424586670),wEa=new $APP.E(null,"_load-file?","_load-file?",-1198848711),L3=new $APP.E(null,"op","op",-1882987955),OEa=new $APP.E(null,"describe","describe",1369790582),N3=new $APP.E(null,"code","code",1586293142),CEa=new $APP.E(null,"eldoc","eldoc",-1321421900),GEa=new $APP.E(null,"log_level","log_level",-1756736313),PEa=new $APP.t(null,"stop-server!","stop-server!",-410772185,null),yEa=new $APP.E("nrepl.middleware.print","print","nrepl.middleware.print/print",
-1616742548),QEa=new $APP.E(null,"clone","clone",711747572),REa=new $APP.E(null,"close","close",1835149582),SEa=new $APP.E(null,"info","info",-317069002),TEa=new $APP.E(null,"macroexpand","macroexpand",-130598183),UEa=new $APP.E(null,"complete","complete",-500388775),VEa=new $APP.E(null,"load-file?","load-file?",1892536169);var U3=function U3(a,b){switch($APP.m.g(J3(a,1))){case "i":return a=I3(a,1),b=lEa(a,"e"),new $APP.F(null,2,5,$APP.H,[parseInt(J3(a,b)),I3(a,b+1)],null);case "l":var d=a=I3(a,1);for(a=$APP.Yc($APP.Nh);;){if($APP.z.h($APP.m.g(J3(d,1)),"e"))return new $APP.F(null,2,5,$APP.H,[$APP.$c(a),I3(d,1)],null);var e=U3.h?U3.h(d,b):U3.call(null,d,b),f=$APP.A.j(e,0,null),h=$APP.A.j(e,1,null);e=h;a=$APP.Mh.h(a,f);d=e}case "d":for(a=I3(a,1),f=$APP.Sg(b),f=$APP.Xe.h(f,$APP.WA),d=a,e=$APP.Yc($APP.Rg);;){if($APP.z.h($APP.m.g(J3(d,
1)),"e"))return new $APP.F(null,2,5,$APP.H,[$APP.$c(e),I3(d,1)],null);a=U3.h?U3.h(d,b):U3.call(null,d,b);d=$APP.A.j(a,0,null);h=$APP.A.j(a,1,null);h=U3.h?U3.h(h,b):U3.call(null,h,b);a=$APP.A.j(h,0,null);h=$APP.A.j(h,1,null);d=$APP.l(f)?$APP.tk.g(d):d;a=$APP.Hi.j(e,d,a);d=h;e=a}default:return b=lEa(a,":"),f=parseInt(J3(a,b)),a=I3(a,b+1),new $APP.F(null,2,5,$APP.H,[$APP.m.g(J3(a,f)),I3(a,f)],null)}},R3=function R3(a){for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;
return R3.l(arguments[0],1<c.length?new $APP.Kd(c.slice(1),0,null):null)};R3.l=function(a,b){try{return U3(a,b)}catch(c){if(c instanceof Error)return new $APP.F(null,2,5,$APP.H,[null,a],null);throw c;}};R3.o=1;R3.v=function(a){var b=$APP.x(a);a=$APP.y(a);return this.l(b,a)};
var Q3=function Q3(a){for(;;){if("string"===typeof a)return[$APP.m.g(Buffer.from(a).length),":",a].join("");if(a instanceof $APP.E||a instanceof $APP.t)a=[function(){var c=$APP.ug(a);return $APP.l(c)?[c,"/"].join(""):null}(),$APP.Qj(a)].join("");else return"number"===typeof a?["i",$APP.m.g(a),"e"].join(""):$APP.He(a)||$APP.Me(a)||null==a?["l",$APP.m.g($APP.qh.h($APP.m,$APP.sk.h(Q3,a))),"e"].join(""):$APP.Ke(a)?["d",$APP.m.g($APP.qh.h($APP.m,$APP.sk.h(function(){return function(c){var d=$APP.A.j(c,
0,null);c=$APP.A.j(c,1,null);return[$APP.m.g(Q3.g?Q3.g(d):Q3.call(null,d)),$APP.m.g(Q3.g?Q3.g(c):Q3.call(null,c))].join("")}}(a),$APP.Az.h($APP.x,a)))),"e"].join(""):null}};var O3=$APP.Rk.g(null),M3=new $APP.k(null,1,["cider.nrepl.pprint/pprint",$APP.u3],null),DEa=$APP.kj([$APP.mX,KEa,REa,NEa,CEa,QEa,OEa,SEa,UEa,TEa,$APP.eia],[function(a,b){var c=new $APP.k(null,2,["status",new $APP.F(null,1,5,$APP.H,["done"],null),"classpath",$APP.Em.h($APP.Hr(),$APP.hk(esm_import$path.delimiter))],null);return b.h?b.h(a,c):b.call(null,a,c)},P3,function(a,b){var c=new $APP.k(null,1,["status",new $APP.F(null,1,5,$APP.H,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},function(a,
b){a=$APP.Sg(a);var c=$APP.Xe.h(a,$APP.yn);return AEa($APP.Gj.l(a,N3,c,$APP.B([VEa,!0,$APP.S,$APP.r($APP.Zs)])),b)},P3,function(a,b){var c=new $APP.k(null,2,["new-session",$APP.m.g($APP.Dl()),"status",new $APP.F(null,1,5,$APP.H,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},function(a,b){var c=new $APP.k(null,4,["versions",new $APP.k(null,2,["nbb-nrepl",tEa("TODO"),"node",tEa(process.version)],null),"aux",$APP.Rg,"ops",$APP.Rj($APP.sk.h($APP.Qj,$APP.Bj(DEa)),$APP.qp.g($APP.Rg)),"status",
new $APP.F(null,1,5,$APP.H,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},P3,function(a,b){var c=$APP.Usa(a);return b.h?b.h(a,c):b.call(null,a,c)},function(a,b){a=$APP.Sg(a);var c=$APP.Xe.h(a,N3),d=$APP.Xe.h(a,LEa);try{return BEa($APP.Gj.j(a,N3,["( ",$APP.m.g(d),"(quote ",$APP.m.g(c),"))"].join("")),function(e,f){var h=f.g?f.g("value"):f.call(null,"value");f=$APP.l(h)?$APP.Gj.j(f,"expansion",h):f;return b.h?b.h(e,f):b.call(null,e,f)})}catch(e){if(e instanceof Error)return c=new $APP.k(null,
3,["ex",$APP.m.g(e),"ns",$APP.m.g($APP.r($APP.Zs)),"status",new $APP.F(null,1,5,$APP.H,["done"],null)],null),b.h?b.h(a,c):b.call(null,a,c);throw e;}},BEa]),HEa=$APP.Rk.g(null),V3=function V3(a){switch(arguments.length){case 0:return V3.A();case 1:return V3.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.m.g(arguments.length)].join(""));}};V3.A=function(){return V3.g($APP.r(HEa))};
V3.g=function(a){return a.close(function(){$APP.dV.h($APP.yT,$APP.sh($APP.ob));$APP.dV.h($APP.FT,$APP.sh($APP.nb));return $APP.l(esm_import$fs.existsSync(".nrepl-port"))?esm_import$fs.unlinkSync(".nrepl-port"):null})};V3.o=1;
var WEa=$APP.hV.h($APP.XD,null),XEa=new $APP.k(null,2,[$APP.nX,function(){var a=new $APP.Id(function(){return S3},MEa,$APP.kj([$APP.S,$APP.P,$APP.yn,$APP.sD,$APP.Fo,$APP.zn,$APP.sS,$APP.Y,$APP.O,$APP.yQ],[$APP.Be(JEa,new $APP.k(null,1,[$APP.O,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),$APP.nX,"nbb/impl/nrepl_server.cljs",20,1,326,326,$APP.I(new $APP.F(null,1,5,$APP.H,[$APP.fC],null)),"Start nRepl server. Accepts options either as JS object or Clojure map.",
$APP.l(S3)?S3.F:null])),b=$APP.r(a),c=$APP.Ce(a);a=$APP.l(null)?null:$APP.P.g(c);var d=new $APP.k(null,4,[$APP.S,WEa,$APP.P,a,$APP.Y,$APP.Y.g(c),$APP.O,$APP.O.g(c)],null);return $APP.l($APP.it.g(c))?$APP.bV.j(a,b,d):$APP.l(function(){var e=$APP.ts.g(c);return $APP.l(e)?e:$APP.Ks.g(c)}())?$APP.cV.j(a,b,d):$APP.Tx.j(a,b,d)}(),PEa,function(){var a=new $APP.Id(function(){return V3},IEa,$APP.kj([$APP.S,$APP.P,$APP.yn,$APP.sD,$APP.RJ,$APP.Fo,$APP.zn,$APP.sS,$APP.Y,$APP.O,$APP.yQ],[$APP.Be(JEa,new $APP.k(null,
1,[$APP.O,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),PEa,"nbb/impl/nrepl_server.cljs",19,new $APP.k(null,6,[$APP.JE,!1,$APP.Mv,1,$APP.JP,1,$APP.eO,new $APP.F(null,2,5,$APP.H,[$APP.Nh,new $APP.F(null,1,5,$APP.H,[T3],null)],null),$APP.Y,$APP.I($APP.Nh,new $APP.F(null,1,5,$APP.H,[T3],null)),$APP.kQ,$APP.I(null,null)],null),1,397,397,$APP.I($APP.Nh,new $APP.F(null,1,5,$APP.H,[T3],null)),null,$APP.l(V3)?V3.F:null])),b=$APP.r(a),c=$APP.Ce(a);a=$APP.l(null)?null:
$APP.P.g(c);var d=new $APP.k(null,4,[$APP.S,WEa,$APP.P,a,$APP.Y,$APP.Y.g(c),$APP.O,$APP.O.g(c)],null);return $APP.l($APP.it.g(c))?$APP.bV.j(a,b,d):$APP.l(function(){var e=$APP.ts.g(c);return $APP.l(e)?e:$APP.Ks.g(c)}())?$APP.cV.j(a,b,d):$APP.Tx.j(a,b,d)}()],null);$APP.Sy(new $APP.k(null,1,[$APP.Ws,new $APP.k(null,1,[$APP.XD,XEa],null)],null));